<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Stranger Things App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Benguiat+ITC&family=Inter:wght@400;500;700;900&family=Permanent+Marker&display=swap" rel="stylesheet">

    <style>
        /* --- GLOBAL RESET --- */
        *, *::before, *::after { box-sizing: border-box; }

        :root {
            --stranger-red: #ff0909;
            --stranger-glow: #ff1a1a;
            --bg-black: #050505;
            --card-glass: rgba(20, 20, 20, 0.75);
            --card-border: rgba(255, 9, 9, 0.2);
            --text-gray: #a1a1a6;
            --nav-height: 70px;
        }

        body {
            margin: 0; padding: 0; 
            background-color: var(--bg-black); 
            color: white;
            font-family: 'Inter', sans-serif; 
            overflow-x: hidden; min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none; user-select: none;
            padding-top: env(safe-area-inset-top); 
            padding-bottom: calc(env(safe-area-inset-bottom) + var(--nav-height));
            background-image: radial-gradient(circle at 50% 30%, #1a0505 0%, #000000 80%);
            background-attachment: fixed;
        }

        /* SCANLINES */
        body::before {
            content: " "; display: block; position: fixed; top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 1000; background-size: 100% 2px, 3px 100%; pointer-events: none; opacity: 0.6;
        }

        /* --- SPLASH SCREEN --- */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, #1a0000 0%, #000000 100%);
            z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            overflow: hidden;
        }
        .intro-container {
            display: flex; flex-direction: column; align-items: center;
            animation: introZoom 3.5s cubic-bezier(0.7, 0, 0.3, 1) forwards;
            transform-origin: center center;
        }
        .splash-text {
            font-family: 'Benguiat ITC', serif; font-weight: 900; color: transparent;
            -webkit-text-stroke: 2px var(--stranger-red); text-transform: uppercase;
            text-align: center; filter: drop-shadow(0 0 10px var(--stranger-red));
            line-height: 0.85; opacity: 0;
        }
        .sp-1 { font-size: 3rem; letter-spacing: 6px; margin-bottom: 5px; animation: fadeInText 1s ease forwards 0.2s; }
        .sp-2 { font-size: 4.5rem; letter-spacing: 0px; margin: 5px 0; animation: fadeInText 1s ease forwards 0.8s; }
        .sp-3 { font-size: 5.5rem; letter-spacing: 8px; margin-top: 5px; animation: fadeInText 1s ease forwards 1.4s; }
        .bar {
            width: 0%; height: 4px; background-color: var(--stranger-red);
            box-shadow: 0 0 20px var(--stranger-red); margin: 30px 0;
            animation: expandBar 2.5s ease-out forwards 0.5s;
        }
        @keyframes introZoom { 0% { transform: scale(0.8); } 20% { transform: scale(1); } 80% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(30); opacity: 0; pointer-events: none; } }
        @keyframes fadeInText { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        @keyframes expandBar { 0% { width: 0%; opacity: 0; } 40% { width: 70%; opacity: 1; } 100% { width: 100%; opacity: 0; } }

        /* --- FONTS --- */
        .stranger-font {
            font-family: 'Benguiat ITC', serif; font-weight: 700; color: transparent;
            -webkit-text-stroke: 1.2px var(--stranger-red); text-transform: uppercase;
            position: relative; text-align: center; filter: drop-shadow(0 0 6px var(--stranger-red));
        }

        /* HEADER */
        .app-header { margin-bottom: 20px; margin-top: 25px; display: flex; justify-content: center; width: 100%; }
        .header-logo .line { display: block; line-height: 0.8; text-shadow: 0 0 10px rgba(255, 0, 0, 0.5); text-align: center; }
        .header-logo .l1 { font-size: 1.2rem; letter-spacing: 2px; }
        .header-logo .l2 { font-size: 2.2rem; letter-spacing: 0px; }
        .header-logo .l3 { font-size: 2.8rem; letter-spacing: 3px; }

        /* TOAST */
        #toast-notification {
            position: fixed; top: -100px; left: 50%; transform: translateX(-50%);
            background: rgba(20, 0, 0, 0.95); border: 1px solid var(--stranger-red);
            color: white; padding: 12px 20px; border-radius: 30px;
            font-size: 13px; font-weight: 700; z-index: 10000;
            box-shadow: 0 5px 20px rgba(255, 9, 9, 0.3);
            display: flex; align-items: center; gap: 10px;
            transition: top 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); width: 90%; max-width: 350px; justify-content: center;
        }
        #toast-notification.show { top: 20px; }

        /* PAGES */
        .page-container { display: none; padding: 10px 16px 20px 16px; margin: 0 auto; width: 100%; opacity: 0; transition: opacity 0.2s; }
        .page-container.active-page { display: block; opacity: 1; }

        /* COUNTDOWN */
        .countdown-banner {
            width: 100%; border-radius: 16px; padding: 25px 20px; margin-bottom: 30px; 
            background: linear-gradient(180deg, rgba(30,0,0,0.6) 0%, rgba(10,0,0,0.8) 100%);
            border: 1px solid var(--card-border); text-align: center;
        }
        .countdown-timer { font-family: 'Benguiat ITC', serif; font-size: 32px; font-weight: 700; color: #fff; margin: 10px 0; text-shadow: 0 0 15px var(--stranger-red); }
        .banner-label { font-size: 11px; text-transform: uppercase; letter-spacing: 2px; color: var(--stranger-red); font-weight: 700; }
        .countdown-subtext { font-size: 12px; color: var(--text-gray); margin-top: 8px; font-weight: 500; }

        /* SELECTOR */
        .season-selector {
            display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 20px;
            margin-left: -16px; margin-right: -16px; padding-left: 16px; padding-right: 16px; scrollbar-width: none;
        }
        .season-btn {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            color: #888; padding: 10px 20px; border-radius: 20px; font-size: 14px; font-weight: 700; 
            cursor: pointer; white-space: nowrap; transition: 0.2s; font-family: 'Benguiat ITC', serif; flex-shrink: 0;
        }
        .season-btn.active {
            background: rgba(255, 9, 9, 0.2); color: white; border-color: var(--stranger-red);
            box-shadow: 0 0 15px rgba(255, 9, 9, 0.3);
        }

        /* CARDS */
        .dates-grid { display: flex; flex-direction: column; gap: 14px; width: 100%; }
        
        .episode-card, .date-card {
            background: var(--card-glass); border-radius: 14px; padding: 15px 18px; 
            border: 1px solid var(--card-border); cursor: pointer; position: relative; overflow: hidden;
            display: flex; align-items: center; gap: 15px; margin-bottom: 10px; transition: all 0.2s;
        }
        .episode-card:active, .date-card:active { transform: scale(0.98); background: rgba(50,50,50,0.8); }
        .date-card::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 3px; background: var(--stranger-red); box-shadow: 2px 0 10px var(--stranger-red); }

        .ep-preview { 
            width: 90px; height: 56px; background: #222; border-radius: 8px; flex-shrink: 0;
            background-image: url('https://d13ezvd6yrslxm.cloudfront.net/wp/wp-content/images/stranger-things-season-5-poster-700x394.jpg');
            background-size: cover; position: relative; opacity: 0.8;
        }
        .ep-preview::after { content: '‚ñ∂'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #fff; font-size: 16px; }
        .ep-details, .date-info { flex-grow: 1; }
        .ep-num { font-size: 10px; color: var(--stranger-red); font-weight: 800; margin-bottom: 3px; letter-spacing: 0.5px; text-transform: uppercase; }
        .ep-title, .date-info h3 { font-size: 15px; color: white; font-weight: 600; line-height: 1.2; margin-bottom: 4px; font-family: 'Benguiat ITC', serif; margin: 0; }
        .date-info p { margin: 0; font-size: 13px; color: var(--text-gray); margin-top: 4px; }

        .episode-card.locked { opacity: 0.6; pointer-events: none; filter: grayscale(1); }
        .episode-card.locked .ep-preview { background-image: none !important; background-color: #151515; display: flex; align-items: center; justify-content: center; }
        .episode-card.locked .ep-preview::after { content: 'üîí'; color: #555; font-size: 20px; }
        .locked-date-badge { font-size: 10px; color: var(--stranger-red); border: 1px solid var(--stranger-red); padding: 2px 6px; border-radius: 4px; display: inline-block; margin-top: 4px; font-weight: 800; text-transform: uppercase; }

        .date-badge-box { background: #181818; width: 52px; height: 52px; border-radius: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center; border: 1px solid #333; }
        .db-day { font-size: 19px; font-weight: 900; color: white; line-height: 1; }
        .db-month { font-size: 9px; font-weight: 800; color: var(--stranger-red); text-transform: uppercase; }
        .available-text { font-weight: 900; font-size: 10px; color: #00ff44; border: 1px solid #005511; padding: 4px 6px; border-radius: 4px; background: rgba(0,255,68,0.1); }

        /* PLAYER */
        .player-section { padding: 5px 0; width: 100%; }
        .player-wrapper { position: relative; width: 100%; background-color: #000; border-radius: 14px; overflow: hidden; aspect-ratio: 16 / 9; background-size: cover; background-position: center; cursor: pointer; border: 1px solid #333; }
        .play-overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 60px; height: 60px; background: rgba(200, 20, 20, 0.2); backdrop-filter: blur(4px); border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 24px; color: white; border: 2px solid white; box-shadow: 0 0 20px rgba(255, 9, 9, 0.5); }
        .play-overlay::after { content: '‚ñ∂'; margin-left: 4px; }
        .controls-area { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; background: var(--card-glass); padding: 10px 14px; border-radius: 12px; border: 1px solid var(--card-border); }
        .nav-btn { background: rgba(255,255,255,0.05); border: none; color: white; width: 36px; height: 36px; border-radius: 10px; font-size: 18px; cursor: pointer; display:flex; align-items:center; justify-content:center; }
        #video-title-text { font-family: 'Benguiat ITC', serif; font-size: 14px; color: #eee; letter-spacing: 0.5px; }

        /* CINEMA & MODAL */
        #cinema-mode { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 5000; flex-direction: column; justify-content: center; align-items: center; }
        .cinema-close-btn { position: absolute; top: 40px; right: 20px; z-index: 5010; background: rgba(30,30,30,0.8); color: white; padding: 10px 20px; border-radius: 20px; border: 1px solid #555; cursor: pointer; font-weight: bold; font-size: 12px; }
        iframe#cinema-iframe { width: 100%; height: 100%; border: none; background: #000; }
        .cinema-controls { position: absolute; bottom: 40px; width: 90%; max-width: 500px; display: flex; justify-content: center; align-items: center; background: rgba(20,20,20,0.8); padding: 15px; border-radius: 20px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .cinema-title { font-size: 14px; font-weight: bold; color: white; margin-bottom: 2px; font-family: 'Benguiat ITC', serif; }

        /* SUB CHECK MODAL */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 6000; justify-content: center; align-items: center; backdrop-filter: blur(8px); }
        .modal-box { background: #121212; border: 1px solid var(--stranger-red); width: 85%; max-width: 320px; padding: 30px; border-radius: 20px; text-align: center; box-shadow: 0 0 50px rgba(255, 9, 9, 0.15); animation: popIn 0.3s; }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-title { color: var(--stranger-red); font-family: 'Benguiat ITC', serif; font-size: 20px; margin-bottom: 15px; }
        .channel-preview { background: #1f1f1f; padding: 12px; border-radius: 10px; color: white; margin-bottom: 20px; font-weight: 600; border: 1px dashed #444; }
        .modal-btn { display: block; width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: 700; margin-bottom: 12px; cursor: pointer; font-size: 14px; }
        .btn-sub { background: #0088cc; color: white; }
        .btn-check { background: transparent; border: 1px solid #444; color: #888; }
        .btn-check.shake { animation: shakeBtn 0.4s ease-in-out; border-color: red; color: red; }
        @keyframes shakeBtn { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

        /* OTHER PAGE */
        .other-card {
            background: var(--card-glass); border: 1px solid var(--card-border);
            border-radius: 16px; padding: 25px 20px; margin-bottom: 20px;
            display: flex; flex-direction: column; align-items: center; text-align: center;
            backdrop-filter: blur(10px); width: 100%;
        }
        .other-icon-box { width: 60px; height: 60px; border-radius: 50%; background: rgba(255, 9, 9, 0.1); border: 1px solid var(--stranger-red); display: flex; justify-content: center; align-items: center; margin-bottom: 15px; color: var(--stranger-red); box-shadow: 0 0 15px rgba(255, 9, 9, 0.2); }
        .other-title { font-family: 'Benguiat ITC', serif; font-size: 18px; margin-bottom: 8px; color: white; }
        .other-text { font-size: 13px; color: var(--text-gray); margin-bottom: 20px; line-height: 1.5; }
        .action-btn { background: var(--stranger-red); color: white; border: none; padding: 14px 24px; border-radius: 12px; font-weight: 800; font-size: 14px; width: 100%; cursor: pointer; box-shadow: 0 5px 15px rgba(255, 9, 9, 0.3); text-transform: uppercase; }

        /* EPISODE LIST PAGE */
        #episodes-page { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-black); background-image: radial-gradient(circle at 50% 30%, #1a0505 0%, #000000 80%); z-index: 2000; flex-direction: column; padding: 20px 16px; overflow-y: auto; }
        .custom-back-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); color: #fff; padding: 10px 18px; border-radius: 30px; font-size: 13px; font-weight: 700; cursor: pointer; margin-bottom: 20px; width: fit-content; display: flex; align-items: center; gap: 8px; }
        .ep-header { margin-bottom: 30px; text-align: center; }
        .ep-header h2 { margin: 5px 0 0; font-size: 28px; font-family: 'Benguiat ITC', serif; }

        /* NAV */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: var(--nav-height); background: rgba(10, 10, 10, 0.95); backdrop-filter: blur(15px); border-top: 1px solid var(--card-border); display: flex; justify-content: space-around; align-items: center; z-index: 500; padding-bottom: env(safe-area-inset-bottom); }
        .nav-item { flex: 1; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; color: #666; cursor: pointer; }
        .nav-item.active { color: var(--stranger-red); text-shadow: 0 0 10px rgba(255, 9, 9, 0.4); }
        .nav-label { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }

    </style>
</head>
<body>

    <!-- TOAST -->
    <div id="toast-notification">
        <span style="font-size:16px;">‚ö†Ô∏è</span>
        <span id="toast-text">–°–Ω–∞—á–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞–Ω–∞–ª!</span>
    </div>

    <!-- CINEMA -->
    <div id="cinema-mode">
        <div class="cinema-close-btn" onclick="closeCinema()">‚úï –ó–ê–ö–†–´–¢–¨</div>
        <div class="cinema-player-box">
            <iframe id="cinema-iframe" allowfullscreen allow="autoplay; fullscreen"></iframe>
        </div>
        <div class="cinema-controls">
            <div style="text-align:center;">
                <div class="cinema-title" id="cinema-title">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–∏–∏</div>
                <div style="font-size: 11px; color: var(--stranger-red); font-weight: 700;">STRANGER THINGS</div>
            </div>
        </div>
    </div>

    <!-- SUB MODAL -->
    <div id="sub-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-title">–î–û–°–¢–£–ü –û–ì–†–ê–ù–ò–ß–ï–ù</div>
            <p style="font-size: 13px; color: #ccc; margin-bottom: 20px; line-height: 1.5;">–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —ç–ø–∏–∑–æ–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª</p>
            <div class="channel-preview" id="modal-chan-name">@channel</div>
            <button class="modal-btn btn-sub" onclick="doSubscribe()">–ü–û–î–ü–ò–°–ê–¢–¨–°–Ø</button>
            <button class="modal-btn btn-check" id="check-sub-btn" onclick="checkSubscription()">–Ø –ü–û–î–ü–ò–°–ê–õ–°–Ø</button>
        </div>
    </div>

    <!-- SPLASH SCREEN -->
    <div id="splash-screen">
        <div class="bar"></div>
        <div class="intro-container">
            <div class="splash-text sp-1">–û–ß–ï–ù–¨</div>
            <div class="splash-text sp-2">–°–¢–†–ê–ù–ù–´–ï</div>
            <div class="splash-text sp-3">–î–ï–õ–ê</div>
        </div>
        <div class="bar"></div>
    </div>

    <!-- EPISODES LIST PAGE -->
    <div id="episodes-page">
        <button class="custom-back-btn" onclick="closePart()"><span>‚Üê</span> –ù–ê–ó–ê–î</button>
        <div class="ep-header">
            <span id="ep-part-subtitle">–°–ï–ó–û–ù <span id="current-season-num">1</span></span>
            <h2 id="ep-part-title">–°–ø–∏—Å–æ–∫ —Å–µ—Ä–∏–π</h2>
        </div>
        <div class="episode-list" id="episode-list-container"></div>
    </div>

    <!-- MAIN PAGE -->
    <div id="main-app" class="page-container active-page">
        <div class="app-header">
            <div class="header-logo stranger-font">
                <span class="line l1">–û–ß–ï–ù–¨</span>
                <span class="line l2">–°–¢–†–ê–ù–ù–´–ï</span>
                <span class="line l3">–î–ï–õ–ê</span>
            </div>
        </div>

        <div class="countdown-banner">
            <div class="banner-content">
                <div class="banner-label">–î–û –í–´–•–û–î–ê –§–ò–ù–ê–õ–¨–ù–û–ô –°–ï–†–ò–ò</div>
                <div class="countdown-timer" id="timer">00 : 00 : 00 : 00</div>
                <div class="countdown-subtext" id="release-date-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
        </div>

        <div class="section-title">–°–µ–∑–æ–Ω—ã</div>
        <div class="season-selector">
            <div class="season-btn" id="s1-btn" onclick="renderSeason(1)">1 –°–ï–ó–û–ù</div>
            <div class="season-btn" id="s2-btn" onclick="renderSeason(2)">2 –°–ï–ó–û–ù</div>
            <div class="season-btn" id="s3-btn" onclick="renderSeason(3)">3 –°–ï–ó–û–ù</div>
            <div class="season-btn" id="s4-btn" onclick="renderSeason(4)">4 –°–ï–ó–û–ù</div>
            <div class="season-btn active" id="s5-btn" onclick="renderSeason(5)">5 –°–ï–ó–û–ù</div>
        </div>

        <div id="season-container"></div>

        <div class="section-title">–¢—Ä–µ–π–ª–µ—Ä—ã</div>
        <div class="player-section">
            <div class="player-wrapper" id="player-trigger" onclick="playCurrentTrailer()">
                <div class="play-overlay"></div>
            </div>
            <div class="controls-area">
                <button class="nav-btn" onclick="changeTrailer(-1)">‚Äπ</button>
                <div id="video-title-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <button class="nav-btn" onclick="changeTrailer(1)">‚Ä∫</button>
            </div>
        </div>
    </div>

    <!-- OTHER PAGE -->
    <div id="other-page" class="page-container">
        <div class="app-header">
            <div class="header-logo stranger-font">
                <span class="line l1">–ú–ï–ù–Æ</span>
                <span class="line l2">–î–†–£–ì–û–ï</span>
            </div>
        </div>
        <div class="other-card">
            <div class="other-icon-box" id="notif-icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg></div>
            <div class="other-title" id="notif-title">–£–í–ï–î–û–ú–õ–ï–ù–ò–Ø</div>
            <div class="other-text" id="notif-text">–í–∫–ª—é—á–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≤—ã—Ö–æ–¥ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å–µ—Ä–∏–∏.</div>
            <button class="action-btn" id="notif-btn" onclick="toggleNotifications()">–í–ö–õ–Æ–ß–ò–¢–¨</button>
        </div>
        <div class="other-card">
            <div class="other-title">–ü–û–î–ï–õ–ò–¢–¨–°–Ø</div>
            <button class="action-btn share-style" onclick="shareApp()">–ü–û–ó–í–ê–¢–¨ –î–†–£–ó–ï–ô</button>
        </div>
    </div>

    <!-- TABS -->
    <div class="bottom-nav" id="bottom-nav">
        <div class="nav-item active" id="tab-home" onclick="switchTab('home')">
            <div class="nav-label">–ì–õ–ê–í–ù–û–ï</div>
        </div>
        <div class="nav-item" id="tab-other" onclick="switchTab('other')">
            <div class="nav-label">–î–†–£–ì–û–ï</div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready(); tg.expand(); tg.setHeaderColor('#050505'); tg.setBackgroundColor('#050505');
        function vibration() { if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light'); }

        const opChannels = [ "strangerthingsfiveseason", "https://t.me/+azpZxcHVlM41OTYy" ];
        const currentAutoChannel = opChannels[0];

        const config = {
            requiredChannel: currentAutoChannel,
            newsChannel: "https://t.me/strangerthingsfiveseason",
            botShareLink: "https://t.me/share/url?url=https://t.me/strangerthings_5_bot",
            trailerLinks: [
                { title: "–¢—Ä–µ–π–ª–µ—Ä 5 —Å–µ–∑–æ–Ω–∞", poster: "https://images.ctfassets.net/4cd45et68cgf/5QQ9QVyTXgnYGTdrnrJLcd/318041d404d528b846e6a39433436322/Stranger_Things_Season_5_Logo.jpg", link: "https://t.me/strangerthingsfiveseason/5" },
                { title: "–í–∏–¥–µ–æ —Å–æ —Å—ä–µ–º–æ–∫", poster: "https://d13ezvd6yrslxm.cloudfront.net/wp/wp-content/images/stranger-things-season-5-poster-700x394.jpg", link: "https://t.me/strangerthingsfiveseason" }
            ]
        };

        // --- LINKS DATABASE ---
        // S1-4 = Rutube (–∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞)
        // S5E8 = PixelDrain (–∏–∑ —Ç–≤–æ–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞)
        const defaultRutube = "https://rutube.ru/play/embed/84990d1f11a41604a1b023910c270395"; 
        
        const linksDB = {
            s1: { 1: defaultRutube, 2: defaultRutube, 3: defaultRutube, 4: defaultRutube, 5: defaultRutube, 6: defaultRutube, 7: defaultRutube, 8: defaultRutube },
            s2: { 1: defaultRutube, 2: defaultRutube, 3: defaultRutube, 4: defaultRutube, 5: defaultRutube, 6: defaultRutube, 7: defaultRutube, 8: defaultRutube, 9: defaultRutube },
            s3: { 1: defaultRutube, 2: defaultRutube, 3: defaultRutube, 4: defaultRutube, 5: defaultRutube, 6: defaultRutube, 7: defaultRutube, 8: defaultRutube },
            s4: { 1: defaultRutube, 2: defaultRutube, 3: defaultRutube, 4: defaultRutube, 5: defaultRutube, 6: defaultRutube, 7: defaultRutube, 8: defaultRutube, 9: defaultRutube },
            s5: { 
                1: defaultRutube, 2: defaultRutube, 3: defaultRutube, 4: defaultRutube, 5: defaultRutube, 6: defaultRutube, 7: defaultRutube, 
                8: "https://pixeldrain.com/u/6vHmCZCD" // –¢–≤–æ—è —Å—Å—ã–ª–∫–∞
            }
        };

        const allSeasonsData = {
            1: [ {id:1, name:"–ì–ª–∞–≤–∞ 1: –ò—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ –£–∏–ª–ª–∞ –ë–∞–π–µ—Ä—Å–∞"}, {id:2, name:"–ì–ª–∞–≤–∞ 2: –ß—É–¥–∞–∫ –Ω–∞ –ú—ç–π–ø–ª-—Å—Ç—Ä–∏—Ç"}, {id:3, name:"–ì–ª–∞–≤–∞ 3: –†–æ–∂–¥–µ—Å—Ç–≤–µ–Ω—Å–∫–∏–µ –æ–≥–Ω–∏"}, {id:4, name:"–ì–ª–∞–≤–∞ 4: –¢–µ–ª–æ"}, {id:5, name:"–ì–ª–∞–≤–∞ 5: –ë–ª–æ—Ö–∞ –∏ –∞–∫—Ä–æ–±–∞—Ç"}, {id:6, name:"–ì–ª–∞–≤–∞ 6: –ú–æ–Ω—Å—Ç—Ä"}, {id:7, name:"–ì–ª–∞–≤–∞ 7: –í–∞–Ω–Ω–∞"}, {id:8, name:"–ì–ª–∞–≤–∞ 8: –ò–∑–Ω–∞–Ω–∫–∞"} ],
            2: [ {id:1, name:"–ì–ª–∞–≤–∞ 1: MADMAX"}, {id:2, name:"–ì–ª–∞–≤–∞ 2: –ö–æ—à–µ–ª—ë–∫ –∏–ª–∏ –∂–∏–∑–Ω—å"}, {id:3, name:"–ì–ª–∞–≤–∞ 3: –ü–æ–ª–ª–∏–≤–æ–≥"}, {id:4, name:"–ì–ª–∞–≤–∞ 4: –£–∏–ª–ª –ú—É–¥—Ä—ã–π"}, {id:5, name:"–ì–ª–∞–≤–∞ 5: Dig Dug"}, {id:6, name:"–ì–ª–∞–≤–∞ 6: –®–ø–∏–æ–Ω"}, {id:7, name:"–ì–ª–∞–≤–∞ 7: –ü–æ—Ç–µ—Ä—è–Ω–Ω–∞—è —Å–µ—Å—Ç—Ä–∞"}, {id:8, name:"–ì–ª–∞–≤–∞ 8: –ò—Å—Ç—è–∑–∞—Ç–µ–ª—å —Ä–∞–∑—É–º–∞"}, {id:9, name:"–ì–ª–∞–≤–∞ 9: –í—Ä–∞—Ç–∞"} ],
            3: [ {id:1, name:"–ì–ª–∞–≤–∞ 1: –°—å—é–∑–∏, –ø—Ä–∏—ë–º!"}, {id:2, name:"–ì–ª–∞–≤–∞ 2: –ö—Ä—ã—Å—ã"}, {id:3, name:"–ì–ª–∞–≤–∞ 3: –°–ø–∞—Å–∞—Ç–µ–ª—å"}, {id:4, name:"–ì–ª–∞–≤–∞ 4: –¢–µ—Å—Ç —Å–∞—É–Ω–æ–π"}, {id:5, name:"–ì–ª–∞–≤–∞ 5: –ò—Å—Ç—è–∑–∞–µ–º—ã–µ"}, {id:6, name:"–ì–ª–∞–≤–∞ 6: E Pluribus Unum"}, {id:7, name:"–ì–ª–∞–≤–∞ 7: –£–∫—É—Å"}, {id:8, name:"–ì–ª–∞–≤–∞ 8: –ë–∏—Ç–≤–∞ –≤ ¬´–°—Ç–∞—Ä–∫–æ—Ä—Ç¬ª"} ],
            4: [ {id:1, name:"–ì–ª–∞–≤–∞ 1: –ö–ª—É–± –ê–¥—Å–∫–æ–≥–æ –ü–ª–∞–º–µ–Ω–∏"}, {id:2, name:"–ì–ª–∞–≤–∞ 2: –ü—Ä–æ–∫–ª—è—Ç–∏–µ –í–µ–∫–Ω—ã"}, {id:3, name:"–ì–ª–∞–≤–∞ 3: –ú–æ–Ω—Å—Ç—Ä –∏ —Å—É–ø–µ—Ä–≥–µ—Ä–æ–π"}, {id:4, name:"–ì–ª–∞–≤–∞ 4: –î–æ—Ä–æ–≥–æ–π –ë–∏–ª–ª–∏"}, {id:5, name:"–ì–ª–∞–≤–∞ 5: –ü—Ä–æ–µ–∫—Ç ¬´–ù–∏–Ω–∞¬ª"}, {id:6, name:"–ì–ª–∞–≤–∞ 6: –ü–æ–≥—Ä—É–∂–µ–Ω–∏–µ"}, {id:7, name:"–ì–ª–∞–≤–∞ 7: –†–µ–∑–Ω—è –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏"}, {id:8, name:"–ì–ª–∞–≤–∞ 8: –ü–∞–ø–∞"}, {id:9, name:"–ì–ª–∞–≤–∞ 9: –ü—Ä–æ–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–µ"} ]
        };

        // --- –î–ê–¢–ê –í–´–•–û–î–ê = –°–ï–ô–ß–ê–° (–ß—Ç–æ–±—ã –±—ã–ª–æ "–î–û–°–¢–£–ü–ù–û") ---
        const targetDate = new Date(new Date().getTime() - 1000); 

        const s5Parts = [
            { id: 'p1', title: "–ß–∞—Å—Ç—å 1 (4 —Å–µ—Ä–∏–∏)", desc: "–ù–∞—á–∞–ª–æ –∫–æ–Ω—Ü–∞", date: new Date(2025,10,26), eps: [ {id:1,name:"–ì–ª–∞–≤–∞ 1: –ü–æ–ª–∑–∞–Ω–∏–µ"}, {id:2,name:"–ì–ª–∞–≤–∞ 2: –ò—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ"}, {id:3,name:"–ì–ª–∞–≤–∞ 3: –õ–æ–≤—É—à–∫–∞"}, {id:4,name:"–ì–ª–∞–≤–∞ 4: –ö–æ–ª–¥—É–Ω"} ] },
            { id: 'p2', title: "–ß–∞—Å—Ç—å 2 (3 —Å–µ—Ä–∏–∏)", desc: "–ë–∏—Ç–≤–∞ –∑–∞ –•–æ—É–∫–∏–Ω—Å", date: new Date(2025,11,25), eps: [ {id:5,name:"–ì–ª–∞–≤–∞ 5: –®–æ–∫–æ–≤–∞—è —Ç–µ—Ä–∞–ø–∏—è"}, {id:6,name:"–ì–ª–∞–≤–∞ 6: –ü–æ–±–µ–≥ –∏–∑ –ö–∞–º–∞–∑–æ—Ç—Ü"}, {id:7,name:"–ì–ª–∞–≤–∞ 7: –ú–æ—Å—Ç"} ] },
            // –ó–¥–µ—Å—å –¥–∞—Ç—É —Ç–æ–∂–µ —Å—Ç–∞–≤–∏–º –≤ –ø—Ä–æ—à–ª–æ–µ
            { id: 'p3', title: "–ß–∞—Å—Ç—å 3 (1 —Å–µ—Ä–∏—è)", desc: "–§–∏–Ω–∞–ª –∏—Å—Ç–æ—Ä–∏–∏", date: targetDate, eps: [ {id:8,name:"–ì–ª–∞–≤–∞ 8: –ü—Ä–∞–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞"} ] }
        ];

        // --- INIT ---
        setTimeout(() => {
            document.getElementById('splash-screen').style.display = 'none';
            document.getElementById('main-app').style.opacity = '1';
            renderSeason(5); 
            document.getElementById('release-date-text').innerText = targetDate.toLocaleDateString() + " (–í–∞—à–µ –≤—Ä–µ–º—è)";
            checkNotifState(); applyConfig();
        }, 3000);

        function renderSeason(num) {
            vibration();
            document.querySelectorAll('.season-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`s${num}-btn`).classList.add('active');
            const cont = document.getElementById('season-container');
            cont.innerHTML = '';

            if(num === 5) {
                const now = new Date();
                s5Parts.forEach((part, idx) => {
                    const isOut = now >= part.date;
                    const badge = isOut ? `<div class="available-text">–î–û–°–¢–£–ü–ù–û</div>` : 
                        `<div class="date-badge-box"><span class="db-day">${part.date.getDate()}</span><span class="db-month">${part.date.toLocaleString('default',{month:'short'})}</span></div>`;
                    
                    const el = document.createElement('div'); el.className = 'date-card';
                    el.innerHTML = `<div class="date-info"><h3>${part.title}</h3><p>${part.desc}</p></div>${badge}`;
                    el.onclick = () => openS5Part(idx);
                    cont.appendChild(el);
                });
            } else {
                const eps = allSeasonsData[num];
                eps.forEach(ep => {
                    const el = document.createElement('div'); el.className = 'episode-card';
                    el.innerHTML = `<div class="ep-preview"></div><div class="ep-details"><div class="ep-num">–°–ï–ó–û–ù ${num} ‚Ä¢ –≠–ü–ò–ó–û–î ${ep.id}</div><div class="ep-title">${ep.name}</div></div>`;
                    el.onclick = () => openCinema(`s${num}e${ep.id}`, ep.name, `–°–ï–ó–û–ù ${num}`);
                    cont.appendChild(el);
                });
            }
        }

        function openS5Part(idx) {
            vibration();
            const part = s5Parts[idx];
            const now = new Date();
            const cont = document.getElementById('episode-list-container');
            cont.innerHTML = '';
            document.getElementById('ep-part-title').innerText = part.title;
            document.getElementById('current-season-num').innerText = "5";

            part.eps.forEach(ep => {
                let isLocked = false; let badge = '';
                if(ep.releaseDate && now < ep.releaseDate) {
                    isLocked = true;
                    badge = `<div class="locked-date-badge">–í–´–•–û–î–ò–¢: ${ep.releaseDate.toLocaleDateString()}</div>`;
                }
                const el = document.createElement('div');
                el.className = `episode-card ${isLocked ? 'locked' : ''}`;
                el.innerHTML = `<div class="ep-preview"></div><div class="ep-details"><div class="ep-num">–≠–ü–ò–ó–û–î ${ep.id}</div><div class="ep-title">${ep.name}</div>${badge}</div>`;
                if(!isLocked) el.onclick = () => openCinema(`s5e${ep.id}`, ep.name, "–°–ï–ó–û–ù 5");
                cont.appendChild(el);
            });

            document.getElementById('main-app').style.display = 'none';
            document.getElementById('episodes-page').style.display = 'flex';
            tg.BackButton.show(); tg.BackButton.onClick(closePart);
        }

        function closePart() {
            vibration();
            document.getElementById('episodes-page').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            tg.BackButton.hide(); tg.BackButton.offClick(closePart);
        }

        // --- SUB & CINEMA LOGIC ---
        let pendingVideo = null;
        let clickedSubLink = false;
        let userHasClickedSub = false;

        function openCinema(globalId, title, subtitle) {
            // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏
            if (!checkSubRequirement(globalId, title, subtitle)) return;

            // 2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏
            const regex = /s(\d+)e(\d+)/; const m = globalId.match(regex);
            const s = `s${m[1]}`; const e = m[2];
            const link = linksDB[s] && linksDB[s][e];

            if(!link) { alert("–°–µ—Ä–∏—è –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∞."); return; }
            vibration();

            document.getElementById('cinema-title').innerText = title;
            
            // 3. –û–ë–†–ê–ë–û–¢–ö–ê PIXELDRAIN (–î–ª—è S5E8)
            let finalSrc = link;
            if (link.includes("pixeldrain")) {
                let id = link.split('/').pop();
                if(id.includes('?')) id = id.split('?')[0];
                finalSrc = `https://pixeldrain.com/u/${id}?embed`;
            }

            document.getElementById('cinema-iframe').src = finalSrc;
            document.getElementById('cinema-mode').style.display = 'flex';
        }

        function checkSubRequirement(vidId, title, sub) {
            if (userHasClickedSub) return true;
            pendingVideo = { id: vidId, t: title, s: sub };
            clickedSubLink = false; 
            const chan = config.requiredChannel;
            const nameEl = document.getElementById('modal-chan-name');
            const subBtn = document.querySelector('.btn-sub');
            if (chan.startsWith('http')) { nameEl.innerText = "–ö–ê–ù–ê–õ –ü–û –û–°–î"; subBtn.innerText = "–ü–û–î–ê–¢–¨ –ó–ê–Ø–í–ö–£"; } else { nameEl.innerText = "@" + chan; subBtn.innerText = "–ü–û–î–ü–ò–°–ê–¢–¨–°–Ø"; }
            document.getElementById('sub-modal').style.display = 'flex';
            return false;
        }

        function doSubscribe() { 
            vibration(); clickedSubLink = true; userHasClickedSub = true;
            const chan = config.requiredChannel;
            if (chan.startsWith('http')) { tg.openTelegramLink(chan); } else { tg.openTelegramLink("https://t.me/" + chan); } 
        }

        function checkSubscription() {
            vibration(); 
            if (!clickedSubLink && !userHasClickedSub) {
                showToast("–°–Ω–∞—á–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞–Ω–∞–ª!");
                const btn = document.getElementById('check-sub-btn');
                btn.classList.add('shake'); setTimeout(() => btn.classList.remove('shake'), 500);
                if(tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('error');
                return;
            }
            document.getElementById('sub-modal').style.display = 'none';
            if (pendingVideo) { openCinema(pendingVideo.id, pendingVideo.t, pendingVideo.s); pendingVideo = null; }
        }

        function closeCinema() {
            document.getElementById('cinema-mode').style.display = 'none';
            document.getElementById('cinema-iframe').src = '';
        }

        function switchTab(tab) {
            vibration();
            if (tab === 'home') {
                document.getElementById('main-app').style.display = 'block';
                document.getElementById('other-page').style.display = 'none';
                setTimeout(()=>document.getElementById('main-app').classList.add('active-page'),10);
                document.getElementById('other-page').classList.remove('active-page');
            } else {
                document.getElementById('main-app').style.display = 'none';
                document.getElementById('other-page').style.display = 'block';
                setTimeout(()=>document.getElementById('other-page').classList.add('active-page'),10);
                document.getElementById('main-app').classList.remove('active-page');
            }
        }
        
        function showToast(msg) { const toast = document.getElementById('toast-notification'); document.getElementById('toast-text').innerText = msg; toast.classList.add('show'); setTimeout(() => toast.classList.remove('show'), 2500); }
        function openNewsChannel() { vibration(); tg.openTelegramLink(config.newsChannel); }
        function shareApp() { vibration(); tg.openTelegramLink(config.botShareLink); }
        function toggleNotifications() { vibration(); localStorage.setItem('notif_status', 'active'); document.getElementById('notif-btn').innerText = "–í–ö–õ–Æ–ß–ï–ù–û"; }
        function checkNotifState() { if(localStorage.getItem('notif_status') === 'active') document.getElementById('notif-btn').innerText = "–í–ö–õ–Æ–ß–ï–ù–û"; }

        const playerWrapper = document.getElementById('player-trigger'); const titleText = document.getElementById('video-title-text'); let currentIdx = 0;
        function applyConfig() { const activeTrailers = config.trailerLinks || []; if(activeTrailers.length > 0) { currentIdx = 0; loadTrailer(0); } else { titleText.innerText = "–¢—Ä–µ–π–ª–µ—Ä–æ–≤ –Ω–µ—Ç"; } }
        function loadTrailer(index) { const activeTrailers = config.trailerLinks; if (activeTrailers.length === 0) return; const item = activeTrailers[index]; playerWrapper.style.backgroundImage = `url('${item.poster}')`; titleText.innerText = item.title; }
        function playCurrentTrailer() { const activeTrailers = config.trailerLinks; if (activeTrailers.length === 0) return; vibration(); const link = activeTrailers[currentIdx].link; tg.openTelegramLink(link); }
        function changeTrailer(direction) { vibration(); const activeTrailers = config.trailerLinks; if (activeTrailers.length === 0) return; currentIdx += direction; if (currentIdx < 0) currentIdx = activeTrailers.length - 1; if (currentIdx >= activeTrailers.length) currentIdx = 0; loadTrailer(currentIdx); }

        function updateTimer() {
            const now = new Date().getTime();
            const dist = targetDate.getTime() - now;
            if(dist < 0) {
                document.getElementById("timer").innerHTML = "–î–û–°–¢–£–ü–ù–û";
                document.getElementById("timer").style.color = "#00ff44";
                return;
            }
            const d = Math.floor(dist / (1000 * 60 * 60 * 24));
            const h = Math.floor((dist % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const m = Math.floor((dist % (1000 * 60 * 60)) / (1000 * 60));
            const s = Math.floor((dist % (1000 * 60)) / 1000);
            document.getElementById("timer").innerHTML = `${d}:${h < 10 ? '0'+h : h}:${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;
        }
        setInterval(updateTimer, 1000); updateTimer();
    </script>
</body>
</html>
